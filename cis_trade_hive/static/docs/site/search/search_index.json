{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to CisTrade Documentation","text":""},{"location":"#overview","title":"Overview","text":"<p>CisTrade is a comprehensive Trade Management System designed for managing portfolios, user-defined fields (UDFs), market data, and trade operations with robust audit trails and a Four-Eyes approval workflow.</p>"},{"location":"#key-features","title":"Key Features","text":"<p> Portfolio Management - Create, edit, and manage portfolios with maker-checker workflow</p> <p> Four-Eyes Principle - Enforced maker-checker approval for all critical operations</p> <p> Apache Kudu/Impala Integration - High-performance data storage and querying</p> <p> Comprehensive Audit Trail - All actions logged to Kudu audit tables</p> <p> UDF Management - Define and manage custom fields for business entities</p> <p> Market Data - FX rates and market data management</p> <p> Real-time Search &amp; Filtering - Fast search across all modules</p>"},{"location":"#documentation-sections","title":"Documentation Sections","text":""},{"location":"#for-business-users","title":"For Business Users","text":"<p>If you're a day-to-day user of CisTrade, start here:</p> <ul> <li> <p> Portfolio Management</p> <p>Learn how to create, edit, and manage portfolios</p> <p> Portfolio Guide</p> </li> <li> <p> Four-Eyes Workflow</p> <p>Understand the maker-checker approval process</p> <p> Workflow Guide</p> </li> <li> <p> UDF Management</p> <p>Manage user-defined fields for custom data</p> <p> UDF Guide</p> </li> <li> <p> Market Data</p> <p>Work with FX rates and market data</p> <p> Market Data Guide</p> </li> </ul>"},{"location":"#for-developers","title":"For Developers","text":"<p>Technical documentation for developers and architects:</p> <ul> <li> <p>:material-architecture:{ .lg .middle } Architecture</p> <p>System architecture and design patterns</p> <p> Architecture</p> </li> <li> <p> Database Schema</p> <p>Kudu/Impala table structures and relationships</p> <p> Schema Docs</p> </li> <li> <p> API Reference</p> <p>Service and repository layer documentation</p> <p> API Docs</p> </li> <li> <p> Development Guide</p> <p>Setup and development workflow</p> <p> Dev Guide</p> </li> </ul>"},{"location":"#for-business-analysts","title":"For Business Analysts","text":"<p>Process flows and business logic documentation:</p> <ul> <li> <p> Business Processes</p> <p>End-to-end business process documentation</p> <p> Processes</p> </li> <li> <p> Data Flow</p> <p>How data moves through the system</p> <p> Data Flow</p> </li> <li> <p> Business Rules</p> <p>Business logic and validation rules</p> <p> Rules</p> </li> <li> <p> Integrations</p> <p>External system integrations</p> <p> Integrations</p> </li> </ul>"},{"location":"#quick-links","title":"Quick Links","text":"<ul> <li> FAQ - Frequently Asked Questions</li> <li> Change Log - Release notes and changes</li> <li> Support - Get help from the team</li> </ul>"},{"location":"#technology-stack","title":"Technology Stack","text":"BackendDatabaseFrontend <ul> <li>Framework: Django 5.2.9</li> <li>Language: Python 3.12</li> <li>Architecture: Repository + Service Layer Pattern</li> </ul> <ul> <li>Primary: Apache Kudu (via Impala)</li> <li>No Django ORM: Direct SQL for all data operations</li> <li>Audit: All actions logged to Kudu audit tables</li> </ul> <ul> <li>Framework: Bootstrap 5</li> <li>Icons: Bootstrap Icons</li> <li>Templates: Django Templates (Jinja2 syntax)</li> </ul>"},{"location":"#system-status","title":"System Status","text":"<p>Production Ready</p> <p>CisTrade is currently in production with the following modules:</p> <ul> <li>\u2705 Portfolio Management</li> <li>\u2705 UDF Management</li> <li>\u2705 Market Data (FX Rates)</li> <li>\u2705 Audit Logging</li> <li>\u2705 Four-Eyes Workflow</li> </ul> <p>Development Mode</p> <p>The system is currently in DEV MODE with:</p> <ul> <li>All permissions bypassed for testing</li> <li>Four-eyes checks disabled for development</li> <li>See <code>DEV_MODE_SETUP.md</code> for details</li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":""},{"location":"#for-business-users_1","title":"For Business Users","text":"<ol> <li>Read the Portfolio Management Guide</li> <li>Understand the Four-Eyes Workflow</li> <li>Check the FAQ for common questions</li> </ol>"},{"location":"#for-developers_1","title":"For Developers","text":"<ol> <li>Review the Architecture</li> <li>Set up your environment with the Development Guide</li> <li>Understand the Database Schema</li> </ol>"},{"location":"#for-business-analysts_1","title":"For Business Analysts","text":"<ol> <li>Study Business Processes</li> <li>Review Data Flow diagrams</li> <li>Check Business Rules</li> </ol>"},{"location":"#need-help","title":"Need Help?","text":"<p>Questions or Issues?</p> <ul> <li>Email: cistrade-support@yourcompany.com</li> <li>In-App Help: Click the Help (?) button in the application</li> <li>Documentation: Browse this site for detailed guides</li> </ul> <p>Last Updated: 2025-12-27 | Version: 1.0.0</p>"},{"location":"changelog/","title":"Change Log","text":"<p>All notable changes to CisTrade will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"changelog/#100-2025-12-27","title":"[1.0.0] - 2025-12-27","text":""},{"location":"changelog/#added","title":"Added","text":"<ul> <li>Initial documentation structure</li> <li>Portfolio Management module with Four-Eyes workflow</li> <li>UDF Management module</li> <li>Market Data (FX Rates) module</li> <li>Comprehensive audit logging to Kudu</li> <li>Repository pattern for data access</li> <li>Service layer for business logic</li> <li>Portfolio close/reactivate functionality</li> <li>Search and filter capabilities</li> <li>CSV export functionality</li> </ul>"},{"location":"changelog/#technical","title":"Technical","text":"<ul> <li>Django 5.2.9 framework</li> <li>Apache Kudu/Impala integration</li> <li>Direct SQL via repository pattern (no Django ORM)</li> <li>Bootstrap 5 UI</li> <li>Development mode with bypassed permissions</li> </ul>"},{"location":"changelog/#documentation","title":"Documentation","text":"<ul> <li>Business user guides</li> <li>Technical architecture documentation</li> <li>Database schema documentation</li> <li>Four-Eyes workflow guide</li> <li>MkDocs with Material theme</li> </ul>"},{"location":"changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"changelog/#planned","title":"Planned","text":"<ul> <li>Redis caching for performance</li> <li>In-app help system with Kudu storage</li> <li>REST API endpoints</li> <li>Advanced search with filters</li> <li>Bulk operations</li> <li>Report generation</li> <li>Dashboard analytics</li> <li>Mobile-responsive improvements</li> </ul>"},{"location":"changelog/#version-history","title":"Version History","text":"Version Release Date Major Changes 1.0.0 2025-12-27 Initial release with core modules <p>Note: This changelog will be updated with each release.</p>"},{"location":"business/","title":"Business User Documentation","text":"<p>Welcome to the business user documentation for CisTrade. This section contains guides and tutorials for day-to-day users of the system.</p>"},{"location":"business/#available-guides","title":"Available Guides","text":"<ul> <li>Portfolio Management - Complete guide to managing portfolios</li> <li>Four-Eyes Workflow - Understanding the maker-checker process</li> <li>UDF Management - Managing user-defined fields (coming soon)</li> <li>Market Data - Working with FX rates and market data (coming soon)</li> <li>Reports - Generating and exporting reports (coming soon)</li> <li>FAQ - Frequently asked questions (coming soon)</li> </ul>"},{"location":"business/#quick-start","title":"Quick Start","text":"<ol> <li>Start with Portfolio Management to learn the basics</li> <li>Read Four-Eyes Workflow to understand approvals</li> <li>Check FAQ for common questions</li> </ol> <p>Need Help? Contact cistrade-support@yourcompany.com</p>"},{"location":"business/four-eyes-workflow/","title":"Four-Eyes Workflow Guide","text":""},{"location":"business/four-eyes-workflow/#what-is-the-four-eyes-principle","title":"What is the Four-Eyes Principle?","text":"<p>The Four-Eyes Principle (also known as Maker-Checker workflow) is a security and compliance mechanism that requires two different people to authorize critical operations. This prevents fraud, errors, and ensures data integrity.</p> <p>Key Rule</p> <p>No single person can both create AND approve a change.</p> <ul> <li>Maker = Creates/edits data</li> <li>Checker = Reviews and approves/rejects</li> </ul> <p>The Maker and Checker must be different people.</p>"},{"location":"business/four-eyes-workflow/#why-four-eyes","title":"Why Four-Eyes?","text":""},{"location":"business/four-eyes-workflow/#benefits","title":"Benefits","text":"<p> Fraud Prevention - No single person can make unauthorized changes</p> <p> Error Detection - Second pair of eyes catches mistakes</p> <p> Compliance - Meets regulatory requirements for financial systems</p> <p> Audit Trail - Complete record of who did what and when</p>"},{"location":"business/four-eyes-workflow/#roles-and-responsibilities","title":"Roles and Responsibilities","text":""},{"location":"business/four-eyes-workflow/#maker-role","title":"Maker Role","text":"<p>Who: Users in the Makers group</p> <p>Responsibilities: - Create new portfolios, UDFs, and other entities - Edit existing items (in Draft or Rejected status only) - Submit items for approval - View their own submissions</p> <p>Cannot: - Approve their own work - Approve any portfolio they created or edited - Directly activate portfolios</p> <p>Typical Tasks: -  Create new portfolio -  Edit draft portfolio -  Submit for approval -  View submission status</p>"},{"location":"business/four-eyes-workflow/#checker-role","title":"Checker Role","text":"<p>Who: Users in the Checkers group</p> <p>Responsibilities: - Review pending submissions - Approve valid submissions - Reject submissions with issues (must provide comments) - Ensure data quality and compliance</p> <p>Cannot: - Approve portfolios they created - Edit portfolios directly - Submit portfolios for approval</p> <p>Typical Tasks: -  Review pending approvals -  Approve valid submissions -  Reject with comments -  Provide feedback</p>"},{"location":"business/four-eyes-workflow/#the-workflow-process","title":"The Workflow Process","text":""},{"location":"business/four-eyes-workflow/#complete-workflow-diagram","title":"Complete Workflow Diagram","text":"<pre><code>graph TD\n    Start([Maker Creates Portfolio]) --&gt; Draft[Draft Status]\n    Draft --&gt; |Maker Edits| Draft\n    Draft --&gt; |Maker Submits| Pending[Pending Approval]\n\n    Pending --&gt; |Checker Reviews| Decision{Checker Decision}\n\n    Decision --&gt; |Approve| Active[Active Status]\n    Decision --&gt; |Reject| Rejected[Rejected Status]\n\n    Rejected --&gt; |Maker Edits| Draft\n\n    Active --&gt; |User Closes| Inactive[Inactive Status]\n    Inactive --&gt; |User Reactivates| Active\n\n    Active --&gt; End([Portfolio in Use])\n\n    style Draft fill:#fff3cd\n    style Pending fill:#cfe2ff\n    style Active fill:#d1e7dd\n    style Rejected fill:#f8d7da\n    style Inactive fill:#e2e3e5</code></pre>"},{"location":"business/four-eyes-workflow/#step-by-step-process","title":"Step-by-Step Process","text":""},{"location":"business/four-eyes-workflow/#step-1-maker-creates-draft","title":"Step 1: Maker Creates (Draft)","text":"<ol> <li>Maker logs into CisTrade</li> <li>Navigates to Portfolios \u2192 Create New</li> <li>Fills in all required fields</li> <li>Clicks \"Create Portfolio\"</li> <li>Result: Portfolio saved with status = Draft</li> </ol> <p>Draft Saved</p> <p>Portfolio is saved but not yet active. It remains in Draft until submitted for approval.</p>"},{"location":"business/four-eyes-workflow/#step-2-maker-edits-optional","title":"Step 2: Maker Edits (Optional)","text":"<ol> <li>Maker can edit Draft portfolio as many times as needed</li> <li>Make changes and click \"Update Portfolio\"</li> <li>Status remains Draft</li> </ol> <p>Review Before Submitting</p> <p>Take your time to review all details before submission. Once submitted, you cannot edit until it's approved or rejected.</p>"},{"location":"business/four-eyes-workflow/#step-3-maker-submits-for-approval","title":"Step 3: Maker Submits for Approval","text":"<ol> <li>Maker opens the Draft portfolio</li> <li>Reviews all details one final time</li> <li>Clicks Submit for Approval</li> <li>Confirms the submission</li> <li>Result: Portfolio status changes to Pending Approval</li> </ol> <p>Cannot Edit After Submission</p> <p>Once submitted, the Maker cannot edit the portfolio until it's either: - Approved (becomes Active - cannot edit) - Rejected (can edit and resubmit)</p>"},{"location":"business/four-eyes-workflow/#step-4-checker-reviews","title":"Step 4: Checker Reviews","text":"<ol> <li>Checker navigates to Pending Approvals</li> <li>Sees list of all portfolios awaiting approval</li> <li>Opens portfolio to review details</li> <li>Checks for:<ul> <li>\u2705 Correct data entry</li> <li>\u2705 Completeness</li> <li>\u2705 Business logic compliance</li> <li>\u2705 No duplicates</li> </ul> </li> </ol>"},{"location":"business/four-eyes-workflow/#step-5-checker-decision","title":"Step 5: Checker Decision","text":"<p>The Checker has two options:</p> \u2705 Approve\u274c Reject <p>When to Approve: - All data is correct - No policy violations - Portfolio serves a valid business purpose</p> <p>How to Approve: 1. Click Approve button 2. Optionally add approval comments 3. Click confirm 4. Result: Portfolio status \u2192 Active</p> <p>Portfolio Activated</p> <p>The portfolio is now active and can be used for transactions.</p> <p>When to Reject: - Data errors found - Missing information - Policy violations - Duplicate portfolio - Invalid business case</p> <p>How to Reject: 1. Click Reject button 2. Required: Enter rejection comments explaining what needs to be fixed 3. Click confirm 4. Result: Portfolio status \u2192 Rejected</p> <p>Comments Required</p> <p>You must provide detailed comments explaining why the portfolio was rejected. This helps the Maker fix the issues.</p>"},{"location":"business/four-eyes-workflow/#step-6a-if-approved","title":"Step 6a: If Approved","text":"<ol> <li>Portfolio status = Active</li> <li>Maker receives notification</li> <li>Portfolio can now be used</li> <li>Portfolio cannot be edited (unless closed and recreated)</li> </ol>"},{"location":"business/four-eyes-workflow/#step-6b-if-rejected","title":"Step 6b: If Rejected","text":"<ol> <li>Portfolio status = Rejected</li> <li>Maker receives notification with Checker's comments</li> <li>Maker can:<ul> <li>Edit the portfolio to fix issues</li> <li>Resubmit for approval</li> </ul> </li> <li>Workflow starts again from Step 3</li> </ol>"},{"location":"business/four-eyes-workflow/#workflow-states","title":"Workflow States","text":""},{"location":"business/four-eyes-workflow/#state-transition-table","title":"State Transition Table","text":"Current Status Who Can Act Available Actions Next Status Draft Maker Edit, Submit Draft (after edit), Pending Approval (after submit) Pending Approval Checker Approve, Reject Active (approve), Rejected (reject) Active Any authorized user Close Inactive Rejected Maker Edit, Resubmit Draft (after edit), Pending Approval (after resubmit) Inactive Any authorized user Reactivate Active"},{"location":"business/four-eyes-workflow/#common-scenarios","title":"Common Scenarios","text":""},{"location":"business/four-eyes-workflow/#scenario-1-first-time-submission-approved","title":"Scenario 1: First Time Submission - Approved","text":"<pre><code>sequenceDiagram\n    actor Alice as Alice (Maker)\n    actor Bob as Bob (Checker)\n    participant System\n\n    Alice-&gt;&gt;System: Create Portfolio\n    System--&gt;&gt;Alice: Draft Status\n    Alice-&gt;&gt;System: Submit for Approval\n    System--&gt;&gt;Bob: Notification\n    Bob-&gt;&gt;System: Review Portfolio\n    Bob-&gt;&gt;System: Approve\n    System--&gt;&gt;Alice: Notification (Approved)\n    System-&gt;&gt;System: Status = Active</code></pre> <p>Timeline: 1. Monday 9:00 AM - Alice creates portfolio 2. Monday 9:15 AM - Alice submits for approval 3. Monday 10:00 AM - Bob reviews and approves 4. Portfolio is now Active</p>"},{"location":"business/four-eyes-workflow/#scenario-2-submission-rejected-fixed-re-approved","title":"Scenario 2: Submission Rejected, Fixed, Re-approved","text":"<pre><code>sequenceDiagram\n    actor Alice as Alice (Maker)\n    actor Bob as Bob (Checker)\n    participant System\n\n    Alice-&gt;&gt;System: Create &amp; Submit Portfolio\n    Bob-&gt;&gt;System: Review Portfolio\n    Bob-&gt;&gt;System: Reject (Missing Currency)\n    System--&gt;&gt;Alice: Rejected with Comments\n    Alice-&gt;&gt;System: Edit Portfolio (Add Currency)\n    Alice-&gt;&gt;System: Resubmit for Approval\n    Bob-&gt;&gt;System: Review Again\n    Bob-&gt;&gt;System: Approve\n    System-&gt;&gt;System: Status = Active</code></pre> <p>Timeline: 1. Monday 9:00 AM - Alice creates and submits portfolio 2. Monday 10:00 AM - Bob rejects (missing currency field) 3. Monday 11:00 AM - Alice fixes and resubmits 4. Monday 2:00 PM - Bob reviews and approves 5. Portfolio is now Active</p>"},{"location":"business/four-eyes-workflow/#scenario-3-cannot-self-approve-violation","title":"Scenario 3: Cannot Self-Approve (Violation)","text":"<pre><code>sequenceDiagram\n    actor Alice as Alice (Maker &amp; Checker)\n    participant System\n\n    Alice-&gt;&gt;System: Create Portfolio (as Maker)\n    Alice-&gt;&gt;System: Submit for Approval\n    Alice-&gt;&gt;System: Try to Approve (as Checker)\n    System--&gt;&gt;Alice: \u274c ERROR: Cannot approve own work</code></pre> <p>Four-Eyes Violation</p> <p>The system prevents users from approving their own submissions, even if they have Checker permissions.</p>"},{"location":"business/four-eyes-workflow/#approval-queue-management","title":"Approval Queue Management","text":""},{"location":"business/four-eyes-workflow/#for-checkers-managing-pending-approvals","title":"For Checkers: Managing Pending Approvals","text":""},{"location":"business/four-eyes-workflow/#view-pending-items","title":"View Pending Items","text":"<ol> <li>Click Pending Approvals button (shows count badge)</li> <li>See list of all items awaiting approval</li> <li>Items sorted by submission date (oldest first)</li> </ol>"},{"location":"business/four-eyes-workflow/#review-priority","title":"Review Priority","text":"<p>Prioritization Tips</p> <ul> <li>Review oldest items first</li> <li>Check urgent items (flagged by Makers)</li> <li>Review high-value portfolios with extra care</li> </ul>"},{"location":"business/four-eyes-workflow/#batch-processing","title":"Batch Processing","text":"<p>While each item must be individually approved, you can: - Sort by submitter to review all items from one Maker - Filter by type (portfolio, UDF, etc.) - Use search to find specific items</p>"},{"location":"business/four-eyes-workflow/#notifications-and-alerts","title":"Notifications and Alerts","text":""},{"location":"business/four-eyes-workflow/#maker-notifications","title":"Maker Notifications","text":"<p>You receive notifications when: - \u2705 Your submission is approved - \u274c Your submission is rejected (with comments) - \ud83d\udd52 Your submission is taking longer than expected</p>"},{"location":"business/four-eyes-workflow/#checker-notifications","title":"Checker Notifications","text":"<p>You receive notifications when: - \ud83d\udce5 New items are submitted for your approval - \u26a0\ufe0f Items are awaiting approval for &gt; 24 hours</p>"},{"location":"business/four-eyes-workflow/#best-practices","title":"Best Practices","text":""},{"location":"business/four-eyes-workflow/#for-makers","title":"For Makers","text":"<p>Maker Best Practices</p> <p>\u2705 Review before submitting - Double-check all fields</p> <p>\u2705 Provide clear descriptions - Help Checkers understand your intent</p> <p>\u2705 Fix rejections quickly - Address Checker comments promptly</p> <p>\u2705 Use Draft status - Save work in progress, submit when complete</p> <p>\u2705 Communicate with Checkers - If urgent, notify them separately</p>"},{"location":"business/four-eyes-workflow/#for-checkers","title":"For Checkers","text":"<p>Checker Best Practices</p> <p>\u2705 Review promptly - Don't let items sit in queue</p> <p>\u2705 Provide detailed rejection comments - Help Makers fix issues</p> <p>\u2705 Check for duplicates - Search before approving</p> <p>\u2705 Validate business logic - Ensure data makes sense</p> <p>\u2705 Don't rubber-stamp - Take time to review carefully</p>"},{"location":"business/four-eyes-workflow/#audit-trail","title":"Audit Trail","text":"<p>Every action in the Four-Eyes workflow is logged:</p>"},{"location":"business/four-eyes-workflow/#what-is-logged","title":"What is Logged","text":"Action Information Captured Create Who created, when, initial values Edit Who edited, when, what changed Submit Who submitted, when Approve Who approved, when, comments Reject Who rejected, when, rejection reason"},{"location":"business/four-eyes-workflow/#viewing-audit-history","title":"Viewing Audit History","text":"<ol> <li>Open any portfolio detail page</li> <li>Scroll to Workflow Information section</li> <li>See complete history:<ul> <li>Created by (user, timestamp)</li> <li>Updated by (user, timestamp)</li> <li>Submitted by (user, timestamp)</li> <li>Approved/Rejected by (user, timestamp, comments)</li> </ul> </li> </ol>"},{"location":"business/four-eyes-workflow/#compliance-and-regulations","title":"Compliance and Regulations","text":""},{"location":"business/four-eyes-workflow/#why-four-eyes-is-required","title":"Why Four-Eyes is Required","text":"<p>CisTrade implements Four-Eyes workflow to comply with:</p> <ul> <li>SOX (Sarbanes-Oxley) - Financial controls and audit trails</li> <li>Internal Audit Requirements - Separation of duties</li> <li>Risk Management - Fraud prevention and error detection</li> <li>Basel III - Operational risk controls (for financial institutions)</li> </ul>"},{"location":"business/four-eyes-workflow/#evidence-for-auditors","title":"Evidence for Auditors","text":"<p>The system provides: - Complete audit logs in Kudu database - Timestamped actions with user identification - Inability to self-approve (system-enforced) - Immutable history (cannot be deleted or modified)</p>"},{"location":"business/four-eyes-workflow/#troubleshooting","title":"Troubleshooting","text":""},{"location":"business/four-eyes-workflow/#problem-cannot-find-approve-button","title":"Problem: Cannot Find Approve Button","text":"<p>Cause: You may be viewing your own submission</p> <p>Solution: Only different users can approve. If you created the portfolio, you cannot approve it. Ask a colleague who is a Checker to review.</p>"},{"location":"business/four-eyes-workflow/#problem-submit-button-grayed-out","title":"Problem: Submit Button Grayed Out","text":"<p>Cause: Portfolio may not be in Draft status</p> <p>Solution: Check portfolio status. Only Draft portfolios can be submitted. If Rejected, edit first, then submit.</p>"},{"location":"business/four-eyes-workflow/#problem-rejection-comments-not-clear","title":"Problem: Rejection Comments Not Clear","text":"<p>Cause: Checker provided minimal feedback</p> <p>Solution: Contact the Checker directly for clarification before editing and resubmitting.</p>"},{"location":"business/four-eyes-workflow/#problem-urgent-approval-needed","title":"Problem: Urgent Approval Needed","text":"<p>Solution: 1. Submit the portfolio normally 2. Contact a Checker directly (email, phone, chat) 3. Ask them to review urgently 4. Provide business justification for urgency</p> <p>No Express Lane</p> <p>There is no way to bypass the Four-Eyes workflow, even for urgent items. Plan ahead and submit early.</p>"},{"location":"business/four-eyes-workflow/#faqs","title":"FAQs","text":"Can I approve if I'm both a Maker and a Checker? <p>No. Even if you have both roles, you cannot approve portfolios you created. The system enforces the Four-Eyes rule.</p> What if the Checker is on vacation? <p>Any Checker can approve any pending item. If your usual Checker is unavailable, another Checker can approve.</p> Can I withdraw a submission? <p>Currently, no. Once submitted, the item must be either approved or rejected by a Checker. Contact a Checker if you need to withdraw.</p> How long should approvals take? <p>Best practice: Checkers should review within 24 hours. Items pending &gt; 48 hours should be escalated.</p> Can I see who approved my portfolio? <p>Yes. Open the portfolio detail page and check the Workflow Information section.</p> What happens if I reject without comments? <p>The system requires rejection comments. You cannot reject without providing a reason.</p> Can I edit an approved portfolio? <p>No. Once approved and active, portfolios cannot be edited. You would need to close it and create a new one with the changes.</p>"},{"location":"business/four-eyes-workflow/#development-mode-note","title":"Development Mode Note","text":"<p>DEV MODE - Four-Eyes Partially Disabled</p> <p>The system is currently in Development Mode where:</p> <ul> <li>All users can create portfolios</li> <li>All users can approve (even their own - for testing)</li> <li>Permission checks are bypassed</li> </ul> <p>In Production, the full Four-Eyes workflow will be enforced: - Only Makers can create - Only Checkers can approve - Users cannot approve their own work (strictly enforced)</p>"},{"location":"business/four-eyes-workflow/#related-topics","title":"Related Topics","text":"<ul> <li>Portfolio Management - How to create and manage portfolios</li> <li>UDF Management - Four-Eyes for UDF definitions</li> <li>Business Processes - Complete process flows</li> </ul>"},{"location":"business/four-eyes-workflow/#need-help","title":"Need Help?","text":"<p>Questions?</p> <ul> <li>In-App Help: Click the Help (?) button</li> <li>Email: cistrade-support@yourcompany.com</li> <li>Escalation: Contact your manager for urgent approvals</li> </ul> <p>Last Updated: 2025-12-27</p>"},{"location":"business/portfolio-management/","title":"Portfolio Management Guide","text":""},{"location":"business/portfolio-management/#overview","title":"Overview","text":"<p>The Portfolio module allows you to create, manage, and track portfolios throughout their lifecycle. All portfolio operations follow the Four-Eyes principle (Maker-Checker workflow) to ensure data integrity and compliance.</p>"},{"location":"business/portfolio-management/#key-concepts","title":"Key Concepts","text":""},{"location":"business/portfolio-management/#portfolio-statuses","title":"Portfolio Statuses","text":"Status Description Next Actions Draft Newly created, not yet submitted Edit, Submit for Approval Pending Approval Awaiting checker approval Approve, Reject (by Checker only) Active Approved and active Close Portfolio Inactive Closed portfolio Reactivate Portfolio Rejected Rejected by checker Edit, Resubmit"},{"location":"business/portfolio-management/#portfolio-lifecycle","title":"Portfolio Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Draft: Create\n    Draft --&gt; PendingApproval: Submit\n    PendingApproval --&gt; Active: Approve\n    PendingApproval --&gt; Rejected: Reject\n    Rejected --&gt; Draft: Edit\n    Draft --&gt; PendingApproval: Resubmit\n    Active --&gt; Inactive: Close\n    Inactive --&gt; Active: Reactivate\n    Active --&gt; [*]</code></pre>"},{"location":"business/portfolio-management/#creating-a-portfolio","title":"Creating a Portfolio","text":""},{"location":"business/portfolio-management/#step-1-navigate-to-portfolio-module","title":"Step 1: Navigate to Portfolio Module","text":"<ol> <li>Click Portfolios in the main navigation menu</li> <li>Click the Create New Portfolio button</li> </ol>"},{"location":"business/portfolio-management/#step-2-fill-in-basic-information","title":"Step 2: Fill in Basic Information","text":"<p>Required Fields</p> <p>Fields marked with * are mandatory</p> <p>Basic Information Section:</p> Field Required Description Example Portfolio Code \u2705 Yes Unique identifier (max 20 characters) <code>PF001</code>, <code>EQUITY-USD</code> Portfolio Name \u2705 Yes Descriptive name (max 200 characters) <code>US Equity Portfolio</code> Description \u274c No Detailed description <code>Portfolio for US equity holdings</code> <p>Financial Information Section:</p> Field Required Description Example Currency \u2705 Yes Base currency for the portfolio <code>USD</code>, <code>EUR</code>, <code>SGD</code> Portfolio Manager \u2705 Yes Name of the portfolio manager <code>John Smith</code> Client \u274c No Client name <code>ABC Corporation</code> Cash Balance \u274c No Initial cash balance <code>1000000.00</code> <p>Classification &amp; Grouping:</p> Field Description Cost Centre Code For internal cost allocation Corp Code Corporate code Account Group Accounting classification Portfolio Group Portfolio grouping for reporting Report Group Reporting classification Entity Group Entity classification Status Active/Inactive (defaults to Active) Revaluation Status Revaluation classification"},{"location":"business/portfolio-management/#step-3-submit-the-form","title":"Step 3: Submit the Form","text":"<ol> <li>Review all entered information</li> <li>Click Create Portfolio button</li> <li>Portfolio is saved in Draft status</li> </ol> <p>Portfolio Created</p> <p>You will see a success message: \"Portfolio created successfully in DRAFT status\"</p> <p>The portfolio is now in your drafts and ready to be submitted for approval.</p>"},{"location":"business/portfolio-management/#editing-a-portfolio","title":"Editing a Portfolio","text":"<p>Edit Restrictions</p> <p>You can only edit portfolios in Draft or Rejected status.</p> <p>Active and Pending Approval portfolios cannot be edited.</p>"},{"location":"business/portfolio-management/#how-to-edit","title":"How to Edit","text":"<ol> <li>Navigate to Portfolios list</li> <li>Find the portfolio you want to edit</li> <li>Click the pencil icon (Edit button)</li> <li>Make your changes</li> <li>Click Update Portfolio</li> </ol>"},{"location":"business/portfolio-management/#submitting-for-approval","title":"Submitting for Approval","text":"<p>Once you're satisfied with the portfolio details:</p>"},{"location":"business/portfolio-management/#step-1-open-portfolio-details","title":"Step 1: Open Portfolio Details","text":"<ol> <li>Go to Portfolios list</li> <li>Click on the portfolio name or eye icon to view details</li> </ol>"},{"location":"business/portfolio-management/#step-2-submit","title":"Step 2: Submit","text":"<ol> <li>Click Submit for Approval button</li> <li>Confirm the submission in the dialog</li> <li>Portfolio status changes to Pending Approval</li> </ol> <p>Maker Role</p> <p>As the Maker, you can only create and submit portfolios.</p> <p>You cannot approve your own work - a different user (Checker) must review and approve.</p>"},{"location":"business/portfolio-management/#search-and-filter","title":"Search and Filter","text":"<p>The Portfolio List page provides powerful search and filter capabilities:</p>"},{"location":"business/portfolio-management/#search-box","title":"Search Box","text":"<p>Search across: - Portfolio Code - Portfolio Name - Manager Name</p> <p>Example: Type <code>USD</code> to find all USD-related portfolios</p>"},{"location":"business/portfolio-management/#filters","title":"Filters","text":"<p>Status Filter: - Draft - Pending Approval - Active - Inactive - Rejected</p> <p>Currency Filter: - Enter currency code (e.g., <code>USD</code>, <code>EUR</code>)</p> <p>How to Use:</p> <ol> <li>Enter search term or select filters</li> <li>Click Search button</li> <li>Click Clear to reset filters</li> </ol> <p></p>"},{"location":"business/portfolio-management/#viewing-portfolio-details","title":"Viewing Portfolio Details","text":""},{"location":"business/portfolio-management/#portfolio-detail-page","title":"Portfolio Detail Page","text":"<p>Click on any portfolio to see:</p> <ul> <li>Basic Information: Code, name, description</li> <li>Financial Details: Currency, manager, client, cash balance</li> <li>Classification: All grouping and classification fields</li> <li>Status Information: Current status with visual badge</li> <li>Workflow History: Who created, submitted, approved/rejected</li> </ul> <p></p>"},{"location":"business/portfolio-management/#closing-a-portfolio","title":"Closing a Portfolio","text":"<p>Active Portfolios Only</p> <p>You can only close portfolios in Active status.</p>"},{"location":"business/portfolio-management/#how-to-close","title":"How to Close","text":"<ol> <li>Open the portfolio detail page</li> <li>Click Close Portfolio button</li> <li> <p>In the modal dialog:</p> <ul> <li>Enter reason for closure (optional but recommended)</li> <li>Click Close Portfolio to confirm</li> </ul> </li> <li> <p>Portfolio status changes to Inactive</p> </li> </ol> <p>Audit Trail</p> <p>Providing a reason for closure helps maintain a clear audit trail.</p>"},{"location":"business/portfolio-management/#what-happens-when-closed","title":"What Happens When Closed?","text":"<ul> <li>Status changes to Inactive</li> <li>Portfolio appears grayed out in the list</li> <li>Cannot perform transactions on closed portfolios</li> <li>Can be reactivated if needed</li> </ul>"},{"location":"business/portfolio-management/#reactivating-a-portfolio","title":"Reactivating a Portfolio","text":"<p>Closed portfolios can be reactivated:</p>"},{"location":"business/portfolio-management/#how-to-reactivate","title":"How to Reactivate","text":"<ol> <li>Open the inactive portfolio detail page</li> <li>Click Reactivate Portfolio button</li> <li> <p>In the modal dialog:</p> <ul> <li>Enter justification for reactivation (required)</li> <li>Click Reactivate Portfolio to confirm</li> </ul> </li> <li> <p>Portfolio status changes back to Active</p> </li> </ol> <p>Justification Required</p> <p>Unlike closing, reactivation requires a justification comment for audit purposes.</p>"},{"location":"business/portfolio-management/#exporting-portfolio-data","title":"Exporting Portfolio Data","text":""},{"location":"business/portfolio-management/#csv-export","title":"CSV Export","text":"<ol> <li>Navigate to Portfolios list</li> <li>Apply any filters if needed</li> <li>Click Download CSV button</li> <li>CSV file downloads with current filtered results</li> </ol> <p>CSV includes: - All visible portfolio columns - Filtered and sorted as displayed - Useful for reporting and analysis</p>"},{"location":"business/portfolio-management/#common-scenarios","title":"Common Scenarios","text":""},{"location":"business/portfolio-management/#scenario-1-creating-your-first-portfolio","title":"Scenario 1: Creating Your First Portfolio","text":"<pre><code>sequenceDiagram\n    actor Maker\n    actor Checker\n    participant System\n\n    Maker-&gt;&gt;System: Create Portfolio (Draft)\n    Maker-&gt;&gt;System: Fill in details\n    Maker-&gt;&gt;System: Save (Draft status)\n    Maker-&gt;&gt;System: Submit for Approval\n    System-&gt;&gt;System: Status: Pending Approval\n    Checker-&gt;&gt;System: Review Portfolio\n    Checker-&gt;&gt;System: Approve\n    System-&gt;&gt;System: Status: Active</code></pre>"},{"location":"business/portfolio-management/#scenario-2-handling-rejected-portfolio","title":"Scenario 2: Handling Rejected Portfolio","text":"<ol> <li>Checker rejects your portfolio with comments</li> <li>You receive notification (status: Rejected)</li> <li>You edit the portfolio to address issues</li> <li>You resubmit for approval</li> <li>Checker approves</li> <li>Portfolio becomes Active</li> </ol>"},{"location":"business/portfolio-management/#scenario-3-temporary-portfolio-closure","title":"Scenario 3: Temporary Portfolio Closure","text":"<ol> <li>You need to temporarily close a portfolio</li> <li>Click Close Portfolio, provide reason: \"Month-end reconciliation\"</li> <li>Perform reconciliation</li> <li>Reactivate portfolio with justification: \"Reconciliation complete\"</li> </ol>"},{"location":"business/portfolio-management/#best-practices","title":"Best Practices","text":"<p>Tips for Success</p> <p>\u2705 Use clear portfolio codes - Make them meaningful and consistent</p> <p>\u2705 Provide detailed descriptions - Help others understand the portfolio purpose</p> <p>\u2705 Double-check before submitting - Review all fields carefully</p> <p>\u2705 Provide closure reasons - Always document why you're closing a portfolio</p> <p>\u2705 Use filters effectively - Save time by filtering before searching</p> <p>Common Mistakes to Avoid</p> <p>\u274c Duplicate portfolio codes - Each must be unique</p> <p>\u274c Missing required fields - You can't save without them</p> <p>\u274c Trying to edit active portfolios - Only Draft/Rejected can be edited</p> <p>\u274c Closing without reason - Always document the business reason</p>"},{"location":"business/portfolio-management/#troubleshooting","title":"Troubleshooting","text":""},{"location":"business/portfolio-management/#problem-cannot-edit-portfolio","title":"Problem: Cannot Edit Portfolio","text":"<p>Solution: Check the portfolio status. Only Draft or Rejected portfolios can be edited.</p> <p>If the portfolio is Active, you cannot edit it. You may need to: - Create a new portfolio with the changes, or - Contact your administrator for special handling</p>"},{"location":"business/portfolio-management/#problem-submit-button-not-visible","title":"Problem: Submit Button Not Visible","text":"<p>Solution: Ensure the portfolio is in Draft status. Portfolios in other statuses cannot be submitted.</p>"},{"location":"business/portfolio-management/#problem-portfolio-not-appearing-in-list","title":"Problem: Portfolio Not Appearing in List","text":"<p>Solution: 1. Check your filter settings 2. Click Clear to reset all filters 3. Try searching by code or name</p>"},{"location":"business/portfolio-management/#problem-cannot-find-portfolio-after-creation","title":"Problem: Cannot Find Portfolio After Creation","text":"<p>Solution: The portfolio is in Draft status. Use the status filter to show only Draft portfolios.</p>"},{"location":"business/portfolio-management/#faqs","title":"FAQs","text":"Can I delete a portfolio? <p>No, portfolios cannot be deleted (hard delete). Instead, use Close Portfolio to mark it as inactive (soft delete). This maintains audit history.</p> Can I edit an active portfolio? <p>No, once approved and active, portfolios cannot be edited through the standard workflow. This ensures data integrity and maintains audit trails.</p> Who can approve my portfolio? <p>Only users in the Checkers group can approve portfolios. Additionally, the checker must be a different person from the maker (Four-Eyes principle).</p> Can I approve my own portfolio? <p>No, the Four-Eyes principle prevents users from approving their own work. A different user (Checker) must approve.</p> What happens if my portfolio is rejected? <p>The portfolio returns to Rejected status. You can edit it to address the checker's comments and resubmit for approval.</p> Can I cancel a pending approval? <p>Currently, the system does not support canceling pending approvals. Contact your administrator if you need to withdraw a submission.</p> How do I know who approved my portfolio? <p>View the portfolio detail page. The workflow section shows who created, submitted, and approved/rejected the portfolio with timestamps.</p>"},{"location":"business/portfolio-management/#related-topics","title":"Related Topics","text":"<ul> <li>Four-Eyes Workflow - Understand the maker-checker process</li> <li>UDF Management - Manage custom fields</li> <li>FAQ - More frequently asked questions</li> </ul>"},{"location":"business/portfolio-management/#need-help","title":"Need Help?","text":"<p>Still Need Assistance?</p> <ul> <li>In-App Help: Click the Help (?) button</li> <li>Email Support: cistrade-support@yourcompany.com</li> <li>Technical Docs: See Architecture for developers</li> </ul> <p>Last Updated: 2025-12-27</p>"},{"location":"business/quick-reference/","title":"CisTrade Quick Reference Card","text":""},{"location":"business/quick-reference/#portfolio-workflow","title":"Portfolio Workflow","text":"<pre><code>Create \u2192 Draft \u2192 Submit \u2192 Pending \u2192 Approve \u2192 Active \u2192 Close \u2192 Inactive\n                              \u2193\n                          Reject \u2192 Edit \u2192 Resubmit\n</code></pre>"},{"location":"business/quick-reference/#key-actions-by-status","title":"Key Actions by Status","text":"Status Available Actions Draft Edit, Submit for Approval Pending Approval Approve, Reject (Checker only) Active Close Portfolio Inactive Reactivate Portfolio Rejected Edit, Resubmit"},{"location":"business/quick-reference/#user-roles","title":"User Roles","text":"<p>Maker: Creates &amp; submits portfolios Checker: Approves/rejects (different user - Four-Eyes)</p>"},{"location":"business/quick-reference/#quick-tips","title":"Quick Tips","text":"<p>\u2705 Required fields: Code, Name, Currency, Manager \u2705 Use search to find portfolios quickly \u2705 Provide reasons when closing/rejecting \u2705 Cannot edit Active portfolios \u2705 Cannot approve your own work</p>"},{"location":"business/quick-reference/#search-shortcuts","title":"Search Shortcuts","text":"<ul> <li>Search by: Code, Name, Manager</li> <li>Filter by: Status, Currency</li> <li>Export: Download CSV button</li> </ul>"},{"location":"business/quick-reference/#common-tasks","title":"Common Tasks","text":"<p>Create Portfolio: Portfolios \u2192 Create New Submit for Approval: Detail page \u2192 Submit button Approve: Pending Approvals \u2192 Approve Close: Active portfolio \u2192 Close button</p>"},{"location":"business/quick-reference/#need-help","title":"Need Help?","text":"<ul> <li>In-App: Click ? icon (top right)</li> <li>Docs: System \u2192 Documentation</li> <li>Support: cistrade-support@yourcompany.com</li> </ul> <p>Print this page for quick reference</p>"},{"location":"integration/","title":"Business Analyst Documentation","text":"<p>Documentation for Business Analysts covering processes, data flows, and business rules.</p>"},{"location":"integration/#documentation-sections","title":"Documentation Sections","text":"<ul> <li>Business Processes - End-to-end process documentation (coming soon)</li> <li>Data Flow - How data moves through the system (coming soon)</li> <li>Business Rules - Business logic and validation rules (coming soon)</li> <li>Integration Points - External system integrations (coming soon)</li> <li>Workflow Diagrams - Visual process flows (coming soon)</li> </ul>"},{"location":"integration/#quick-start-for-bas","title":"Quick Start for BAs","text":"<ol> <li>Review Business Processes for process flows</li> <li>Check Data Flow for data movement</li> <li>See Business Rules for validation logic</li> </ol> <p>Contact: ba-team@yourcompany.com</p>"},{"location":"technical/","title":"Technical Documentation","text":"<p>Technical documentation for developers, architects, and DevOps engineers.</p>"},{"location":"technical/#documentation-sections","title":"Documentation Sections","text":"<ul> <li>Architecture - System architecture and design patterns</li> <li>Database Schema - Kudu/Impala table structures</li> <li>API Reference - Service and repository layer documentation (coming soon)</li> <li>Code Structure - Project organization (coming soon)</li> <li>Development Guide - Local setup and development workflow (coming soon)</li> <li>Deployment - Production deployment guide (coming soon)</li> <li>Testing - Testing strategy and practices (coming soon)</li> </ul>"},{"location":"technical/#quick-start-for-developers","title":"Quick Start for Developers","text":"<ol> <li>Review the Architecture document</li> <li>Understand the Database Schema</li> <li>Follow the Development Guide to set up your environment</li> </ol> <p>Contributors: See <code>CONTRIBUTING.md</code> in the repository</p>"},{"location":"technical/api-reference/","title":"API Reference","text":"<p>Quick reference for service and repository methods.</p>"},{"location":"technical/api-reference/#portfolio-service","title":"Portfolio Service","text":"<p>Location: <code>portfolio/services/portfolio_service.py</code></p>"},{"location":"technical/api-reference/#core-methods","title":"Core Methods","text":"Method Parameters Returns Description <code>create_portfolio()</code> user, data Portfolio Create new portfolio in Draft <code>update_portfolio()</code> portfolio, user, data Portfolio Update Draft/Rejected only <code>submit_for_approval()</code> portfolio, user Portfolio Submit Draft \u2192 Pending <code>approve_portfolio()</code> portfolio, user, comments Portfolio Approve \u2192 Active <code>reject_portfolio()</code> portfolio, user, comments Portfolio Reject with reason <code>close_portfolio()</code> code, user_id, username, email, reason bool Close Active \u2192 Inactive <code>reactivate_portfolio()</code> code, user_id, username, email, comments bool Reactivate Inactive \u2192 Active"},{"location":"technical/api-reference/#query-methods","title":"Query Methods","text":"Method Returns Description <code>list_portfolios(status, search, currency)</code> QuerySet Filter portfolios <code>get_pending_approvals()</code> QuerySet Pending items <code>get_portfolio_by_id(id)</code> Portfolio Get by ID <code>get_portfolio_by_code(code)</code> Portfolio Get by code"},{"location":"technical/api-reference/#portfolio-repository","title":"Portfolio Repository","text":"<p>Location: <code>portfolio/repositories/portfolio_hive_repository.py</code></p>"},{"location":"technical/api-reference/#methods","title":"Methods","text":"<pre><code>get_all_portfolios(limit=100, status=None, search=None, currency=None) -&gt; List[Dict]\nget_portfolio_by_code(code: str) -&gt; Optional[Dict]\nupdate_portfolio_status(code, status, is_active, updated_by) -&gt; bool\ninsert_portfolio_history(code, action, status, changes, comments, performed_by) -&gt; bool\n</code></pre>"},{"location":"technical/api-reference/#audit-repository","title":"Audit Repository","text":"<p>Location: <code>core/audit/audit_kudu_repository.py</code></p> <pre><code>log_action(user_id, username, user_email, action_type, entity_type,\n           entity_id, entity_name, action_description, request_method, status) -&gt; bool\n</code></pre>"},{"location":"technical/api-reference/#help-repository","title":"Help Repository","text":"<p>Location: <code>core/repositories/help_repository.py</code></p> <pre><code>get_help_content(module, page, section=None) -&gt; List[Dict]\nget_all_help() -&gt; List[Dict]\n</code></pre>"},{"location":"technical/api-reference/#usage-examples","title":"Usage Examples","text":""},{"location":"technical/api-reference/#create-portfolio","title":"Create Portfolio","text":"<pre><code>from portfolio.services import PortfolioService\n\nportfolio = PortfolioService.create_portfolio(\n    user=request.user,\n    data={\n        'code': 'PF001',\n        'name': 'Test Portfolio',\n        'currency': 'USD',\n        'manager': 'John Smith'\n    }\n)\n</code></pre>"},{"location":"technical/api-reference/#query-portfolios","title":"Query Portfolios","text":"<pre><code>portfolios = PortfolioService.list_portfolios(\n    status='Active',\n    search='USD',\n    currency='USD'\n)\n</code></pre>"},{"location":"technical/api-reference/#log-audit","title":"Log Audit","text":"<pre><code>from core.audit.audit_kudu_repository import audit_log_kudu_repository\n\naudit_log_kudu_repository.log_action(\n    user_id='123',\n    username='jsmith',\n    user_email='jsmith@company.com',\n    action_type='CREATE',\n    entity_type='PORTFOLIO',\n    entity_id='PF001',\n    entity_name='Test Portfolio',\n    action_description='Created portfolio PF001',\n    request_method='POST',\n    status='SUCCESS'\n)\n</code></pre> <p>For complete implementation details, see Architecture and Database Schema.</p>"},{"location":"technical/architecture/","title":"CisTrade Architecture","text":""},{"location":"technical/architecture/#system-overview","title":"System Overview","text":"<p>CisTrade is a Django-based Trade Management System built with a clean architecture that emphasizes separation of concerns, maintainability, and performance. The system uses Apache Kudu/Impala as the primary data store instead of traditional relational databases.</p> <pre><code>graph TB\n    subgraph \"Client Layer\"\n        Browser[Web Browser]\n    end\n\n    subgraph \"Presentation Layer\"\n        Templates[Django Templates]\n        Static[Static Assets&lt;br/&gt;CSS, JS, Images]\n    end\n\n    subgraph \"Application Layer\"\n        Views[Views Layer&lt;br/&gt;HTTP Handlers]\n        Services[Service Layer&lt;br/&gt;Business Logic]\n    end\n\n    subgraph \"Data Access Layer\"\n        Repositories[Repository Layer&lt;br/&gt;Data Access]\n    end\n\n    subgraph \"Data Layer\"\n        Kudu[(Apache Kudu&lt;br/&gt;via Impala)]\n    end\n\n    Browser --&gt; Views\n    Views --&gt; Templates\n    Views --&gt; Static\n    Views --&gt; Services\n    Services --&gt; Repositories\n    Repositories --&gt; Kudu\n\n    style Browser fill:#e3f2fd\n    style Views fill:#fff3e0\n    style Services fill:#f3e5f5\n    style Repositories fill:#e8f5e9\n    style Kudu fill:#fce4ec</code></pre>"},{"location":"technical/architecture/#technology-stack","title":"Technology Stack","text":""},{"location":"technical/architecture/#backend","title":"Backend","text":"Component Technology Version Purpose Framework Django 5.2.9 Web framework Language Python 3.12 Programming language Web Server Django Dev Server Built-in Development server WSGI Gunicorn TBD Production WSGI server"},{"location":"technical/architecture/#database","title":"Database","text":"Component Technology Purpose Primary Database Apache Kudu Fast analytics on fast data Query Engine Impala SQL queries on Kudu Connection impyla Python Impala client ORM None Direct SQL via repository pattern"},{"location":"technical/architecture/#frontend","title":"Frontend","text":"Component Technology Version Purpose CSS Framework Bootstrap 5.x UI components and layout Icons Bootstrap Icons 1.x Icon library JavaScript Vanilla JS ES6+ Client-side interactivity Template Engine Django Templates Built-in Server-side rendering"},{"location":"technical/architecture/#architecture-patterns","title":"Architecture Patterns","text":""},{"location":"technical/architecture/#1-repository-pattern","title":"1. Repository Pattern","text":"<p>The Repository pattern abstracts data access logic and provides a clean interface for the service layer.</p> <p>Purpose: - Separate data access from business logic - Provide consistent interface for different data sources - Enable testability through mocking</p> <p>Structure:</p> <pre><code># Repository Interface (Abstract)\nclass BaseRepository:\n    def get_all(self, **filters) -&gt; List[Dict]\n    def get_by_id(self, id: str) -&gt; Optional[Dict]\n    def create(self, data: Dict) -&gt; bool\n    def update(self, id: str, data: Dict) -&gt; bool\n    def delete(self, id: str) -&gt; bool\n\n# Concrete Implementation\nclass PortfolioHiveRepository(BaseRepository):\n    \"\"\"Repository for Portfolio data in Kudu/Impala.\"\"\"\n\n    def __init__(self):\n        self.connection = ImpalaConnection()\n\n    def get_all_portfolios(self, limit=100, **filters) -&gt; List[Dict]:\n        query = \"SELECT * FROM gmp_cis.cis_portfolio\"\n        # Apply filters\n        return self.execute_query(query)\n</code></pre> <p>Benefits: - \u2705 Easy to switch data sources - \u2705 Testable with mocks - \u2705 Single responsibility - \u2705 Query optimization in one place</p>"},{"location":"technical/architecture/#2-service-layer-pattern","title":"2. Service Layer Pattern","text":"<p>The Service layer contains all business logic and orchestrates operations between repositories.</p> <p>Purpose: - Centralize business logic - Coordinate multi-step operations - Enforce business rules - Handle transactions</p> <p>Structure:</p> <pre><code>class PortfolioService:\n    \"\"\"Service for Portfolio business logic.\"\"\"\n\n    @staticmethod\n    def create_portfolio(user: User, data: Dict) -&gt; Portfolio:\n        # 1. Validate data\n        # 2. Check business rules\n        # 3. Call repository\n        # 4. Log to audit\n        # 5. Return result\n        pass\n\n    @staticmethod\n    def submit_for_approval(portfolio, user: User) -&gt; Portfolio:\n        # 1. Validate status\n        # 2. Update portfolio\n        # 3. Create history record\n        # 4. Log to audit\n        pass\n</code></pre> <p>Benefits: - \u2705 Business logic in one place - \u2705 Reusable across views - \u2705 Easy to test - \u2705 Transaction management</p>"},{"location":"technical/architecture/#3-four-eyes-maker-checker-pattern","title":"3. Four-Eyes (Maker-Checker) Pattern","text":"<p>Purpose: Enforce separation of duties for critical operations</p> <p>Implementation:</p> <pre><code>stateDiagram-v2\n    [*] --&gt; Draft: Maker Creates\n    Draft --&gt; PendingApproval: Maker Submits\n    PendingApproval --&gt; Active: Checker Approves\n    PendingApproval --&gt; Rejected: Checker Rejects\n    Rejected --&gt; Draft: Maker Edits\n    Active --&gt; Inactive: User Closes\n    Inactive --&gt; Active: User Reactivates</code></pre> <p>Key Rules: - User cannot approve their own submission - Approval requires Checker role - Full audit trail for all transitions</p>"},{"location":"technical/architecture/#4-soft-delete-pattern","title":"4. Soft Delete Pattern","text":"<p>Purpose: Mark records as inactive instead of physical deletion</p> <p>Implementation:</p> <pre><code># Instead of DELETE FROM table WHERE id = X\n# We use UPDATE:\nUPDATE cis_portfolio\nSET status = 'Inactive',\n    is_active = false,\n    updated_by = 'username'\nWHERE name = 'portfolio_code'\n</code></pre> <p>Benefits: - \u2705 Maintain audit history - \u2705 Enable reactivation - \u2705 Data recovery - \u2705 Compliance</p>"},{"location":"technical/architecture/#layered-architecture","title":"Layered Architecture","text":""},{"location":"technical/architecture/#layer-1-presentation-layer","title":"Layer 1: Presentation Layer","text":"<p>Components: - Django Templates (<code>.html</code> files) - Static files (CSS, JavaScript, Images) - Template tags and filters</p> <p>Responsibilities: - Render HTML - Display data - Capture user input - Client-side validation</p> <p>Location: <code>templates/</code>, <code>static/</code></p> <p>Example: <pre><code>&lt;!-- templates/portfolio/portfolio_list.html --&gt;\n{% extends 'base.html' %}\n{% block content %}\n    &lt;table&gt;\n        {% for portfolio in portfolios %}\n            &lt;tr&gt;&lt;td&gt;{{ portfolio.name }}&lt;/td&gt;&lt;/tr&gt;\n        {% endfor %}\n    &lt;/table&gt;\n{% endblock %}\n</code></pre></p>"},{"location":"technical/architecture/#layer-2-view-layer","title":"Layer 2: View Layer","text":"<p>Components: - Django view functions - URL routing - Request/response handling</p> <p>Responsibilities: - Handle HTTP requests - Call service layer - Prepare context for templates - Return HTTP responses</p> <p>Location: <code>*/views.py</code>, <code>*/urls.py</code></p> <p>Example: <pre><code># portfolio/views.py\ndef portfolio_list(request):\n    # 1. Get query parameters\n    search = request.GET.get('search', '')\n\n    # 2. Call service layer\n    portfolios = PortfolioService.list_portfolios(search=search)\n\n    # 3. Prepare context\n    context = {'portfolios': portfolios}\n\n    # 4. Render template\n    return render(request, 'portfolio/portfolio_list.html', context)\n</code></pre></p>"},{"location":"technical/architecture/#layer-3-service-layer","title":"Layer 3: Service Layer","text":"<p>Components: - Service classes with static methods - Business logic - Workflow orchestration</p> <p>Responsibilities: - Validate business rules - Coordinate repository calls - Manage transactions - Log audit events</p> <p>Location: <code>*/services/*.py</code></p> <p>Example: <pre><code># portfolio/services/portfolio_service.py\nclass PortfolioService:\n    @staticmethod\n    def submit_for_approval(portfolio: Portfolio, user: User):\n        # Validate\n        if portfolio.status != 'DRAFT':\n            raise ValidationError(\"Only draft portfolios can be submitted\")\n\n        # Update in repository\n        portfolio.status = 'PENDING_APPROVAL'\n        portfolio.submitted_by = user\n        portfolio.save()\n\n        # Create history\n        PortfolioHistory.objects.create(...)\n\n        # Audit log\n        audit_log_kudu_repository.log_action(...)\n\n        return portfolio\n</code></pre></p>"},{"location":"technical/architecture/#layer-4-repository-layer","title":"Layer 4: Repository Layer","text":"<p>Components: - Repository classes - SQL query builders - Impala connection management</p> <p>Responsibilities: - Execute SQL queries - Map results to dictionaries/objects - Handle database errors - Manage connections</p> <p>Location: <code>*/repositories/*.py</code></p> <p>Example: <pre><code># portfolio/repositories/portfolio_hive_repository.py\nclass PortfolioHiveRepository:\n    def get_all_portfolios(self, limit=100, status=None):\n        query = f\"\"\"\n            SELECT name, description, currency, status, created_at\n            FROM gmp_cis.cis_portfolio\n        \"\"\"\n        if status:\n            query += f\" WHERE status = '{status}'\"\n\n        query += f\" LIMIT {limit}\"\n\n        return self.execute_query(query)\n</code></pre></p>"},{"location":"technical/architecture/#layer-5-data-layer","title":"Layer 5: Data Layer","text":"<p>Components: - Apache Kudu tables - Impala query engine</p> <p>Responsibilities: - Store data - Execute queries - Maintain ACID properties - Handle partitioning</p> <p>Tables: - <code>gmp_cis.cis_portfolio</code> - <code>gmp_cis.cis_portfolio_history</code> - <code>gmp_cis.cis_audit_log</code> - <code>gmp_cis.cis_udf_master</code> - <code>gmp_cis.cis_fx_rate</code></p>"},{"location":"technical/architecture/#data-flow","title":"Data Flow","text":""},{"location":"technical/architecture/#read-operation-flow","title":"Read Operation Flow","text":"<pre><code>sequenceDiagram\n    actor User\n    participant View\n    participant Service\n    participant Repository\n    participant Kudu\n\n    User-&gt;&gt;View: HTTP GET /portfolio/\n    View-&gt;&gt;Service: list_portfolios(filters)\n    Service-&gt;&gt;Repository: get_all_portfolios(filters)\n    Repository-&gt;&gt;Kudu: SELECT * FROM cis_portfolio\n    Kudu--&gt;&gt;Repository: Result rows\n    Repository--&gt;&gt;Service: List[Dict]\n    Service--&gt;&gt;View: Portfolios\n    View--&gt;&gt;User: Rendered HTML</code></pre>"},{"location":"technical/architecture/#write-operation-flow","title":"Write Operation Flow","text":"<pre><code>sequenceDiagram\n    actor User\n    participant View\n    participant Service\n    participant Repository\n    participant Kudu\n\n    User-&gt;&gt;View: HTTP POST /portfolio/create/\n    View-&gt;&gt;Service: create_portfolio(user, data)\n    Service-&gt;&gt;Service: Validate data\n    Service-&gt;&gt;Repository: insert_portfolio(data)\n    Repository-&gt;&gt;Kudu: INSERT INTO cis_portfolio\n    Kudu--&gt;&gt;Repository: Success\n    Repository-&gt;&gt;Kudu: INSERT INTO cis_audit_log\n    Kudu--&gt;&gt;Repository: Success\n    Repository--&gt;&gt;Service: Portfolio created\n    Service--&gt;&gt;View: Success response\n    View--&gt;&gt;User: Redirect to portfolio detail</code></pre>"},{"location":"technical/architecture/#design-principles","title":"Design Principles","text":""},{"location":"technical/architecture/#solid-principles","title":"SOLID Principles","text":""},{"location":"technical/architecture/#single-responsibility-principle-srp","title":"Single Responsibility Principle (SRP)","text":"<ul> <li>Each class has one reason to change</li> <li><code>PortfolioService</code> handles business logic only</li> <li><code>PortfolioHiveRepository</code> handles data access only</li> <li><code>portfolio_list()</code> view handles HTTP only</li> </ul>"},{"location":"technical/architecture/#openclosed-principle-ocp","title":"Open/Closed Principle (OCP)","text":"<ul> <li>Service methods are extensible</li> <li>Can add new status transitions without modifying existing code</li> <li>Can add new repositories without changing services</li> </ul>"},{"location":"technical/architecture/#liskov-substitution-principle-lsp","title":"Liskov Substitution Principle (LSP)","text":"<ul> <li>Repository implementations are interchangeable</li> <li>Can swap <code>HiveRepository</code> with <code>PostgresRepository</code> without changing services</li> </ul>"},{"location":"technical/architecture/#interface-segregation-principle-isp","title":"Interface Segregation Principle (ISP)","text":"<ul> <li>Repositories expose only needed methods</li> <li>Services don't force views to depend on unnecessary methods</li> </ul>"},{"location":"technical/architecture/#dependency-inversion-principle-dip","title":"Dependency Inversion Principle (DIP)","text":"<ul> <li>Service depends on Repository abstraction, not concrete implementation</li> <li>Easy to mock repositories for testing</li> </ul>"},{"location":"technical/architecture/#security-architecture","title":"Security Architecture","text":""},{"location":"technical/architecture/#authentication","title":"Authentication","text":"<pre><code>graph LR\n    User[User] --&gt; Login[Login Page]\n    Login --&gt; ACL[ACL Repository]\n    ACL --&gt; Impala[(Impala&lt;br/&gt;gmp_acl table)]\n    Impala --&gt; Validate{Credentials&lt;br/&gt;Valid?}\n    Validate --&gt;|Yes| Session[Create Session]\n    Validate --&gt;|No| Error[Login Error]\n    Session --&gt; Dashboard[Dashboard]</code></pre> <p>Authentication Flow: 1. User enters username/password 2. <code>ACLRepository</code> queries Impala ACL table 3. Password validated 4. Session created 5. User permissions loaded</p>"},{"location":"technical/architecture/#authorization","title":"Authorization","text":"<p>Permission Model: - Module-based permissions (e.g., <code>cis-portfolio</code>, <code>cis-udf</code>) - Operation-based access (READ, WRITE, DELETE, ADMIN) - Stored in Impala ACL tables</p> <p>Four-Eyes Enforcement: <pre><code>def can_approve(portfolio, user):\n    # User must be Checker\n    if not user.groups.filter(name='Checkers').exists():\n        return False\n\n    # User cannot approve own work\n    if portfolio.created_by == user:\n        return False\n\n    return True\n</code></pre></p>"},{"location":"technical/architecture/#audit-trail","title":"Audit Trail","text":"<p>What is Logged: - User ID, username, email - Action type (CREATE, UPDATE, DELETE, APPROVE, REJECT) - Entity type and ID - Timestamp - Request method - Success/failure status</p> <p>Storage: <code>gmp_cis.cis_audit_log</code> table in Kudu</p>"},{"location":"technical/architecture/#performance-optimization","title":"Performance Optimization","text":""},{"location":"technical/architecture/#caching-strategy","title":"Caching Strategy","text":"<p>Plan (not yet implemented): <pre><code># Cache help content\ncache.set(f'help_{module}_{page}', content, timeout=3600)\n\n# Cache dropdown options\ncache.set('currencies', currency_list, timeout=86400)\n\n# Cache user permissions\ncache.set(f'permissions_{user.id}', permissions, timeout=3600)\n</code></pre></p>"},{"location":"technical/architecture/#database-optimization","title":"Database Optimization","text":"<p>Kudu Partitioning: <pre><code>CREATE TABLE gmp_cis.cis_portfolio (\n    ...\n)\nPARTITION BY HASH(name) PARTITIONS 16\nSTORED AS KUDU;\n</code></pre></p> <p>Benefits: - Parallel query execution - Better data distribution - Faster inserts</p> <p>Query Optimization: - Use WHERE clauses to leverage partitioning - Limit result sets - Index on frequently queried columns</p>"},{"location":"technical/architecture/#error-handling","title":"Error Handling","text":""},{"location":"technical/architecture/#exception-hierarchy","title":"Exception Hierarchy","text":"<pre><code># Custom exceptions\nclass CisTradeException(Exception):\n    \"\"\"Base exception for CisTrade\"\"\"\n\nclass ValidationError(CisTradeException):\n    \"\"\"Data validation errors\"\"\"\n\nclass PermissionDenied(CisTradeException):\n    \"\"\"Authorization errors\"\"\"\n\nclass DataNotFound(CisTradeException):\n    \"\"\"Entity not found\"\"\"\n</code></pre>"},{"location":"technical/architecture/#error-handling-pattern","title":"Error Handling Pattern","text":"<pre><code>try:\n    portfolio = PortfolioService.create_portfolio(user, data)\n    messages.success(request, 'Portfolio created successfully')\n    return redirect('portfolio:detail', portfolio.id)\n\nexcept ValidationError as e:\n    messages.error(request, str(e))\n    return render(request, 'portfolio/portfolio_form.html', context)\n\nexcept PermissionDenied:\n    messages.error(request, 'You do not have permission to create portfolios')\n    return redirect('dashboard')\n\nexcept Exception as e:\n    logger.error(f'Unexpected error: {e}', exc_info=True)\n    messages.error(request, 'An unexpected error occurred')\n    return redirect('dashboard')\n</code></pre>"},{"location":"technical/architecture/#development-mode-vs-production","title":"Development Mode vs Production","text":""},{"location":"technical/architecture/#dev-mode-current","title":"DEV MODE (Current)","text":"<pre><code># DEV_MODE_SETUP.md\n- All permissions bypassed\n- Four-eyes checks disabled\n- Self-approval allowed (for testing)\n- Verbose logging enabled\n</code></pre>"},{"location":"technical/architecture/#production-mode","title":"Production Mode","text":"<pre><code># Production configuration\n- Strict permission checks\n- Four-eyes strictly enforced\n- Cannot self-approve\n- Optimized logging\n- HTTPS required\n- CSRF protection enabled\n</code></pre>"},{"location":"technical/architecture/#module-structure","title":"Module Structure","text":"<pre><code>cis_trade_hive/\n\u251c\u2500\u2500 config/                 # Django settings\n\u2502   \u251c\u2500\u2500 settings.py\n\u2502   \u251c\u2500\u2500 urls.py\n\u2502   \u2514\u2500\u2500 wsgi.py\n\u2502\n\u251c\u2500\u2500 core/                   # Core functionality\n\u2502   \u251c\u2500\u2500 audit/             # Audit logging\n\u2502   \u251c\u2500\u2500 repositories/      # Core repositories\n\u2502   \u251c\u2500\u2500 views/             # Authentication, dashboard\n\u2502   \u2514\u2500\u2500 models.py          # Core models\n\u2502\n\u251c\u2500\u2500 portfolio/             # Portfolio module\n\u2502   \u251c\u2500\u2500 management/        # Django management commands\n\u2502   \u251c\u2500\u2500 repositories/      # Portfolio repositories\n\u2502   \u251c\u2500\u2500 services/          # Portfolio services\n\u2502   \u251c\u2500\u2500 views.py           # Portfolio views\n\u2502   \u251c\u2500\u2500 urls.py            # Portfolio URLs\n\u2502   \u2514\u2500\u2500 models.py          # Portfolio models\n\u2502\n\u251c\u2500\u2500 udf/                   # UDF module\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 views.py\n\u2502   \u2514\u2500\u2500 urls.py\n\u2502\n\u251c\u2500\u2500 market_data/           # Market data module\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 views.py\n\u2502   \u2514\u2500\u2500 urls.py\n\u2502\n\u251c\u2500\u2500 templates/             # HTML templates\n\u2502   \u251c\u2500\u2500 base.html\n\u2502   \u251c\u2500\u2500 portfolio/\n\u2502   \u251c\u2500\u2500 udf/\n\u2502   \u2514\u2500\u2500 market_data/\n\u2502\n\u2514\u2500\u2500 static/                # Static assets\n    \u251c\u2500\u2500 css/\n    \u251c\u2500\u2500 js/\n    \u2514\u2500\u2500 images/\n</code></pre>"},{"location":"technical/architecture/#deployment-architecture","title":"Deployment Architecture","text":""},{"location":"technical/architecture/#development","title":"Development","text":"<pre><code>graph LR\n    Dev[Developer] --&gt; Django[Django Dev Server&lt;br/&gt;localhost:8000]\n    Django --&gt; Kudu[Kudu Dev&lt;br/&gt;Cluster]</code></pre>"},{"location":"technical/architecture/#production-proposed","title":"Production (Proposed)","text":"<pre><code>graph TB\n    LB[Load Balancer&lt;br/&gt;nginx] --&gt; App1[Django + Gunicorn&lt;br/&gt;Instance 1]\n    LB --&gt; App2[Django + Gunicorn&lt;br/&gt;Instance 2]\n    App1 --&gt; Redis[(Redis Cache)]\n    App2 --&gt; Redis\n    App1 --&gt; Kudu[(Kudu Production&lt;br/&gt;Cluster)]\n    App2 --&gt; Kudu</code></pre>"},{"location":"technical/architecture/#future-enhancements","title":"Future Enhancements","text":""},{"location":"technical/architecture/#short-term","title":"Short Term","text":"<ul> <li> Implement Redis caching</li> <li> Add API endpoints (REST)</li> <li> Implement WebSocket for real-time updates</li> <li> Add advanced search (Elasticsearch)</li> </ul>"},{"location":"technical/architecture/#long-term","title":"Long Term","text":"<ul> <li> Microservices architecture</li> <li> Event-driven architecture (Kafka)</li> <li> GraphQL API</li> <li> Mobile app (React Native)</li> </ul>"},{"location":"technical/architecture/#related-documentation","title":"Related Documentation","text":"<ul> <li>Database Schema - Detailed table structures</li> <li>API Reference - Service and repository methods</li> <li>Development Guide - Setup and workflow</li> <li>Deployment - Production deployment</li> </ul> <p>Last Updated: 2025-12-27 | Version: 1.0.0</p>"},{"location":"technical/database-schema/","title":"Database Schema Documentation","text":""},{"location":"technical/database-schema/#overview","title":"Overview","text":"<p>CisTrade uses Apache Kudu as the primary data store, accessed via Impala SQL queries. All tables are stored in the <code>gmp_cis</code> database schema in Kudu and queried using Impala.</p> <p>No Django ORM</p> <p>This system does NOT use Django ORM for data operations. All database access is through direct SQL queries via the repository pattern.</p>"},{"location":"technical/database-schema/#database-design-principles","title":"Database Design Principles","text":""},{"location":"technical/database-schema/#1-kudu-first-design","title":"1. Kudu-First Design","text":"<ul> <li>Tables are optimized for Kudu's columnar storage</li> <li>Partitioning by hash for even data distribution</li> <li>Primary keys are immutable</li> </ul>"},{"location":"technical/database-schema/#2-audit-trail","title":"2. Audit Trail","text":"<ul> <li>Every table includes <code>created_at</code>, <code>updated_at</code> timestamps</li> <li>Separate audit log table (<code>cis_audit_log</code>) for all actions</li> <li>History tables track changes over time</li> </ul>"},{"location":"technical/database-schema/#3-soft-deletes","title":"3. Soft Deletes","text":"<ul> <li>Records are marked <code>inactive</code> rather than physically deleted</li> <li><code>status</code> field tracks lifecycle (Active/Inactive)</li> <li><code>is_active</code> boolean for quick filtering</li> </ul>"},{"location":"technical/database-schema/#4-denormalization","title":"4. Denormalization","text":"<ul> <li>Some data is denormalized for query performance</li> <li>Avoid complex joins</li> <li>Balance between normalization and performance</li> </ul>"},{"location":"technical/database-schema/#database-schema","title":"Database Schema","text":""},{"location":"technical/database-schema/#schema-diagram","title":"Schema Diagram","text":"<pre><code>erDiagram\n    CIS_PORTFOLIO ||--o{ CIS_PORTFOLIO_HISTORY : has\n    CIS_UDF_MASTER ||--o{ CIS_UDF_VALUE : defines\n    CIS_UDF_VALUE ||--o{ CIS_UDF_VALUE_HISTORY : tracks\n\n    CIS_PORTFOLIO {\n        string name PK\n        string description\n        string currency\n        string manager\n        string portfolio_client\n        double cash_balance\n        string status\n        boolean is_active\n        timestamp created_at\n        timestamp updated_at\n    }\n\n    CIS_PORTFOLIO_HISTORY {\n        string id PK\n        string portfolio_code FK\n        string action\n        string status\n        string changes\n        string comments\n        string performed_by\n        timestamp performed_at\n    }\n\n    CIS_UDF_MASTER {\n        int udf_id PK\n        string udf_code\n        string udf_name\n        string entity_type\n        string data_type\n        boolean is_active\n    }\n\n    CIS_UDF_VALUE {\n        string value_id PK\n        int udf_id FK\n        string entity_type\n        string entity_code\n        string value\n        date effective_date\n        date end_date\n        boolean is_active\n    }\n\n    CIS_AUDIT_LOG {\n        string id PK\n        string user_id\n        string username\n        string action_type\n        string entity_type\n        string entity_id\n        timestamp timestamp\n    }\n\n    CIS_FX_RATE {\n        string rate_id PK\n        string from_currency\n        string to_currency\n        double rate\n        date effective_date\n        boolean is_active\n    }</code></pre>"},{"location":"technical/database-schema/#table-specifications","title":"Table Specifications","text":""},{"location":"technical/database-schema/#1-cis_portfolio","title":"1. cis_portfolio","text":"<p>Purpose: Main portfolio table storing all portfolio records</p> <p>Table Definition: <pre><code>CREATE TABLE gmp_cis.cis_portfolio (\n    -- Identification\n    name STRING NOT NULL,               -- Portfolio name (unique, serves as PK)\n    description STRING,                 -- Portfolio description\n\n    -- Financial Information\n    currency STRING,                    -- Base currency (USD, EUR, etc.)\n    manager STRING,                     -- Portfolio manager name\n    portfolio_client STRING,            -- Client name\n    cash_balance DOUBLE,                -- Current cash balance\n\n    -- Classification\n    cost_centre_code STRING,            -- Cost centre code\n    corp_code STRING,                   -- Corporate code\n    account_group STRING,               -- Account group classification\n    portfolio_group STRING,             -- Portfolio group\n    report_group STRING,                -- Report group\n    entity_group STRING,                -- Entity group\n    revaluation_status STRING,          -- Revaluation status\n\n    -- Status &amp; Lifecycle\n    status STRING,                      -- Active, Inactive\n    is_active BOOLEAN,                  -- Quick active flag\n\n    -- Audit Fields\n    created_at TIMESTAMP,               -- Creation timestamp\n    updated_at TIMESTAMP,               -- Last update timestamp\n    created_by STRING,                  -- Creator username\n    updated_by STRING,                  -- Last updater username\n\n    PRIMARY KEY (name)\n)\nPARTITION BY HASH(name) PARTITIONS 16\nSTORED AS KUDU;\n</code></pre></p> <p>Indexes: - Primary: <code>name</code> - Common queries on: <code>status</code>, <code>currency</code>, <code>manager</code></p> <p>Sample Data: <pre><code>INSERT INTO gmp_cis.cis_portfolio VALUES (\n    'US EQUITY FUND',                   -- name\n    'US Equity Portfolio',              -- description\n    'USD',                              -- currency\n    'John Smith',                       -- manager\n    'ABC Corporation',                  -- portfolio_client\n    1000000.00,                         -- cash_balance\n    'CC001',                            -- cost_centre_code\n    'CORP01',                           -- corp_code\n    'AG001',                            -- account_group\n    'PG001',                            -- portfolio_group\n    'RG001',                            -- report_group\n    'EG001',                            -- entity_group\n    'DAILY',                            -- revaluation_status\n    'Active',                           -- status\n    true,                               -- is_active\n    NOW(),                              -- created_at\n    NOW(),                              -- updated_at\n    'jsmith',                           -- created_by\n    'jsmith'                            -- updated_by\n);\n</code></pre></p> <p>Common Queries:</p> <pre><code>-- Get all active portfolios\nSELECT * FROM gmp_cis.cis_portfolio\nWHERE status = 'Active' AND is_active = true;\n\n-- Search portfolios\nSELECT * FROM gmp_cis.cis_portfolio\nWHERE name LIKE '%EQUITY%'\n   OR manager LIKE '%Smith%';\n\n-- Filter by currency\nSELECT * FROM gmp_cis.cis_portfolio\nWHERE currency = 'USD' AND status = 'Active';\n</code></pre>"},{"location":"technical/database-schema/#2-cis_portfolio_history","title":"2. cis_portfolio_history","text":"<p>Purpose: Track all changes to portfolios (audit trail)</p> <p>Table Definition: <pre><code>CREATE TABLE gmp_cis.cis_portfolio_history (\n    -- Identity\n    id STRING NOT NULL,                 -- Unique history record ID\n    portfolio_code STRING,              -- Portfolio name (FK)\n\n    -- Change Information\n    action STRING,                      -- CLOSE, REACTIVATE, UPDATE, CREATE\n    status STRING,                      -- New status after action\n    changes STRING,                     -- JSON string of changes\n    comments STRING,                    -- User comments\n    performed_by STRING,                -- Username who performed action\n    performed_at TIMESTAMP,             -- When action was performed\n\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id) PARTITIONS 4\nSTORED AS KUDU;\n</code></pre></p> <p>Sample Data: <pre><code>INSERT INTO gmp_cis.cis_portfolio_history VALUES (\n    'hist_001',                         -- id\n    'US EQUITY FUND',                   -- portfolio_code\n    'CLOSE',                            -- action\n    'Inactive',                         -- status\n    '{\"status\": {\"old\": \"Active\", \"new\": \"Inactive\"}}',  -- changes\n    'Month-end reconciliation',         -- comments\n    'jsmith',                           -- performed_by\n    NOW()                               -- performed_at\n);\n</code></pre></p> <p>Common Queries: <pre><code>-- Get history for a portfolio\nSELECT *\nFROM gmp_cis.cis_portfolio_history\nWHERE portfolio_code = 'US EQUITY FUND'\nORDER BY performed_at DESC;\n\n-- Get all close actions in the last 30 days\nSELECT *\nFROM gmp_cis.cis_portfolio_history\nWHERE action = 'CLOSE'\n  AND performed_at &gt;= DATE_SUB(NOW(), INTERVAL 30 DAY);\n</code></pre></p>"},{"location":"technical/database-schema/#3-cis_audit_log","title":"3. cis_audit_log","text":"<p>Purpose: Comprehensive audit trail for all system actions</p> <p>Table Definition: <pre><code>CREATE TABLE gmp_cis.cis_audit_log (\n    -- Identity\n    id STRING NOT NULL,                 -- Unique audit ID\n\n    -- User Information\n    user_id STRING,                     -- User ID\n    username STRING,                    -- Username\n    user_email STRING,                  -- User email\n\n    -- Action Information\n    action_type STRING,                 -- CREATE, UPDATE, DELETE, APPROVE, etc.\n    entity_type STRING,                 -- PORTFOLIO, UDF, FX_RATE\n    entity_id STRING,                   -- ID of affected entity\n    entity_name STRING,                 -- Name of affected entity\n    action_description STRING,          -- Human-readable description\n\n    -- Request Information\n    request_method STRING,              -- GET, POST, PUT, DELETE\n    request_path STRING,                -- URL path\n    ip_address STRING,                  -- Client IP\n    user_agent STRING,                  -- Browser user agent\n\n    -- Outcome\n    status STRING,                      -- SUCCESS, FAILURE, ERROR\n    error_message STRING,               -- Error details if failed\n\n    -- Timestamp\n    timestamp TIMESTAMP,                -- When action occurred\n\n    PRIMARY KEY (id)\n)\nPARTITION BY HASH(id) PARTITIONS 8\nSTORED AS KUDU;\n</code></pre></p> <p>Sample Data: <pre><code>INSERT INTO gmp_cis.cis_audit_log VALUES (\n    'audit_001',                        -- id\n    '123',                              -- user_id\n    'jsmith',                           -- username\n    'jsmith@company.com',               -- user_email\n    'CREATE',                           -- action_type\n    'PORTFOLIO',                        -- entity_type\n    'US EQUITY FUND',                   -- entity_id\n    'US EQUITY FUND',                   -- entity_name\n    'Created portfolio US EQUITY FUND', -- action_description\n    'POST',                             -- request_method\n    '/portfolio/create/',               -- request_path\n    '192.168.1.100',                    -- ip_address\n    'Mozilla/5.0...',                   -- user_agent\n    'SUCCESS',                          -- status\n    NULL,                               -- error_message\n    NOW()                               -- timestamp\n);\n</code></pre></p> <p>Common Queries: <pre><code>-- Get recent audit logs\nSELECT *\nFROM gmp_cis.cis_audit_log\nORDER BY timestamp DESC\nLIMIT 100;\n\n-- Get audit logs for a user\nSELECT *\nFROM gmp_cis.cis_audit_log\nWHERE username = 'jsmith'\nORDER BY timestamp DESC;\n\n-- Get failed actions\nSELECT *\nFROM gmp_cis.cis_audit_log\nWHERE status = 'FAILURE'\n  AND timestamp &gt;= DATE_SUB(NOW(), INTERVAL 7 DAY);\n</code></pre></p>"},{"location":"technical/database-schema/#4-cis_udf_master","title":"4. cis_udf_master","text":"<p>Purpose: Define user-defined fields (custom fields)</p> <p>Table Definition: <pre><code>CREATE TABLE gmp_cis.cis_udf_master (\n    -- Identity\n    udf_id INT NOT NULL,                -- Unique UDF ID\n    udf_code STRING,                    -- UDF code (unique)\n    udf_name STRING,                    -- UDF name\n\n    -- Classification\n    entity_type STRING,                 -- PORTFOLIO, TRADE, POSITION\n    category STRING,                    -- Grouping category\n    data_type STRING,                   -- STRING, NUMBER, DATE, BOOLEAN\n\n    -- Validation\n    min_value STRING,                   -- Minimum value (for numeric)\n    max_value STRING,                   -- Maximum value (for numeric)\n    allowed_values STRING,              -- Comma-separated list\n    is_mandatory BOOLEAN,               -- Required field?\n\n    -- Display\n    display_order INT,                  -- Order in UI\n    description STRING,                 -- Help text\n\n    -- Status\n    is_active BOOLEAN,                  -- Active/Inactive\n    created_at TIMESTAMP,\n    updated_at TIMESTAMP,\n    created_by STRING,\n    updated_by STRING,\n\n    PRIMARY KEY (udf_id)\n)\nPARTITION BY HASH(udf_id) PARTITIONS 4\nSTORED AS KUDU;\n</code></pre></p> <p>Sample Data: <pre><code>INSERT INTO gmp_cis.cis_udf_master VALUES (\n    1,                                  -- udf_id\n    'RISK_RATING',                      -- udf_code\n    'Risk Rating',                      -- udf_name\n    'PORTFOLIO',                        -- entity_type\n    'RISK',                             -- category\n    'STRING',                           -- data_type\n    NULL,                               -- min_value\n    NULL,                               -- max_value\n    'LOW,MEDIUM,HIGH',                  -- allowed_values\n    true,                               -- is_mandatory\n    1,                                  -- display_order\n    'Risk rating for the portfolio',    -- description\n    true,                               -- is_active\n    NOW(),                              -- created_at\n    NOW(),                              -- updated_at\n    'admin',                            -- created_by\n    'admin'                             -- updated_by\n);\n</code></pre></p>"},{"location":"technical/database-schema/#5-cis_udf_value","title":"5. cis_udf_value","text":"<p>Purpose: Store actual UDF values for entities</p> <p>Table Definition: <pre><code>CREATE TABLE gmp_cis.cis_udf_value (\n    -- Identity\n    value_id STRING NOT NULL,           -- Unique value ID\n    udf_id INT,                         -- Foreign key to cis_udf_master\n\n    -- Entity Reference\n    entity_type STRING,                 -- PORTFOLIO, TRADE, etc.\n    entity_code STRING,                 -- Entity identifier\n\n    -- Value\n    value STRING,                       -- The actual UDF value\n    numeric_value DOUBLE,               -- Numeric representation\n    date_value DATE,                    -- Date representation\n\n    -- Validity Period\n    effective_date DATE,                -- Start date\n    end_date DATE,                      -- End date (NULL = current)\n\n    -- Status\n    is_active BOOLEAN,\n    created_at TIMESTAMP,\n    updated_at TIMESTAMP,\n    created_by STRING,\n    updated_by STRING,\n\n    PRIMARY KEY (value_id)\n)\nPARTITION BY HASH(value_id) PARTITIONS 4\nSTORED AS KUDU;\n</code></pre></p> <p>Sample Data: <pre><code>INSERT INTO gmp_cis.cis_udf_value VALUES (\n    'val_001',                          -- value_id\n    1,                                  -- udf_id (RISK_RATING)\n    'PORTFOLIO',                        -- entity_type\n    'US EQUITY FUND',                   -- entity_code\n    'HIGH',                             -- value\n    NULL,                               -- numeric_value\n    NULL,                               -- date_value\n    '2025-01-01',                       -- effective_date\n    NULL,                               -- end_date (current)\n    true,                               -- is_active\n    NOW(),                              -- created_at\n    NOW(),                              -- updated_at\n    'jsmith',                           -- created_by\n    'jsmith'                            -- updated_by\n);\n</code></pre></p>"},{"location":"technical/database-schema/#6-cis_fx_rate","title":"6. cis_fx_rate","text":"<p>Purpose: Store foreign exchange rates</p> <p>Table Definition: <pre><code>CREATE TABLE gmp_cis.cis_fx_rate (\n    -- Identity\n    rate_id STRING NOT NULL,            -- Unique rate ID\n\n    -- Currency Pair\n    from_currency STRING,               -- Base currency\n    to_currency STRING,                 -- Quote currency\n\n    -- Rate\n    rate DOUBLE,                        -- Exchange rate\n    inverse_rate DOUBLE,                -- 1/rate\n\n    -- Validity\n    effective_date DATE,                -- Effective date\n    source STRING,                      -- Data source (BLOOMBERG, REUTERS)\n\n    -- Status\n    is_active BOOLEAN,\n    created_at TIMESTAMP,\n    updated_at TIMESTAMP,\n    created_by STRING,\n    updated_by STRING,\n\n    PRIMARY KEY (rate_id)\n)\nPARTITION BY HASH(rate_id) PARTITIONS 4\nSTORED AS KUDU;\n</code></pre></p> <p>Sample Data: <pre><code>INSERT INTO gmp_cis.cis_fx_rate VALUES (\n    'rate_001',                         -- rate_id\n    'USD',                              -- from_currency\n    'EUR',                              -- to_currency\n    0.85,                               -- rate\n    1.18,                               -- inverse_rate\n    '2025-12-27',                       -- effective_date\n    'BLOOMBERG',                        -- source\n    true,                               -- is_active\n    NOW(),                              -- created_at\n    NOW(),                              -- updated_at\n    'system',                           -- created_by\n    'system'                            -- updated_by\n);\n</code></pre></p> <p>Common Queries: <pre><code>-- Get current rate for USD/EUR\nSELECT rate\nFROM gmp_cis.cis_fx_rate\nWHERE from_currency = 'USD'\n  AND to_currency = 'EUR'\n  AND is_active = true\n  AND effective_date &lt;= CURRENT_DATE\nORDER BY effective_date DESC\nLIMIT 1;\n</code></pre></p>"},{"location":"technical/database-schema/#data-types","title":"Data Types","text":""},{"location":"technical/database-schema/#kudu-data-types-used","title":"Kudu Data Types Used","text":"Kudu Type Usage Example <code>STRING</code> Text fields, codes, names Portfolio name, currency code <code>INT</code> Integer IDs, counts UDF ID, display order <code>DOUBLE</code> Decimal numbers, amounts Cash balance, FX rates <code>BOOLEAN</code> True/false flags is_active, is_mandatory <code>TIMESTAMP</code> Date and time created_at, updated_at <code>DATE</code> Date only effective_date, end_date"},{"location":"technical/database-schema/#partitioning-strategy","title":"Partitioning Strategy","text":""},{"location":"technical/database-schema/#hash-partitioning","title":"Hash Partitioning","text":"<p>All tables use HASH partitioning for even data distribution:</p> <pre><code>PARTITION BY HASH(primary_key) PARTITIONS N\n</code></pre> <p>Partition Counts: - Large tables (audit_log, portfolio): 8-16 partitions - Medium tables (udf_value, fx_rate): 4 partitions - Small tables (udf_master, history): 4 partitions</p> <p>Benefits: - \u2705 Even data distribution - \u2705 Parallel query execution - \u2705 Scalability - \u2705 Better insert performance</p>"},{"location":"technical/database-schema/#indexing-strategy","title":"Indexing Strategy","text":""},{"location":"technical/database-schema/#primary-keys","title":"Primary Keys","text":"<p>All tables have a primary key: - Unique identifier for each row - Enables fast lookups by key - Required for Kudu upserts</p>"},{"location":"technical/database-schema/#secondary-indexes","title":"Secondary Indexes","text":"<p>Kudu supports bloom filter indexes (not yet implemented):</p> <pre><code>-- Future: Add bloom filter for faster lookups\nCREATE INDEX idx_portfolio_status\nON gmp_cis.cis_portfolio (status, is_active);\n</code></pre>"},{"location":"technical/database-schema/#naming-conventions","title":"Naming Conventions","text":""},{"location":"technical/database-schema/#tables","title":"Tables","text":"<ul> <li>Prefix: <code>cis_</code></li> <li>Lowercase with underscores: <code>cis_portfolio</code>, <code>cis_udf_master</code></li> <li>Descriptive names</li> </ul>"},{"location":"technical/database-schema/#columns","title":"Columns","text":"<ul> <li>Lowercase with underscores: <code>portfolio_code</code>, <code>created_at</code></li> <li>Suffix for special types:</li> <li><code>_id</code> for IDs</li> <li><code>_at</code> for timestamps</li> <li><code>_by</code> for users</li> <li><code>_date</code> for dates</li> </ul>"},{"location":"technical/database-schema/#performance-optimization","title":"Performance Optimization","text":""},{"location":"technical/database-schema/#query-best-practices","title":"Query Best Practices","text":"<pre><code>-- \u2705 Good: Filter on partitioned column\nSELECT * FROM cis_portfolio WHERE name = 'US EQUITY FUND';\n\n-- \u2705 Good: Use indexed columns in WHERE\nSELECT * FROM cis_portfolio WHERE status = 'Active' AND is_active = true;\n\n-- \u274c Bad: Full table scan\nSELECT * FROM cis_portfolio WHERE description LIKE '%equity%';\n\n-- \u2705 Better: Limit results\nSELECT * FROM cis_portfolio WHERE description LIKE '%equity%' LIMIT 100;\n</code></pre>"},{"location":"technical/database-schema/#batch-operations","title":"Batch Operations","text":"<pre><code>-- Instead of multiple single inserts:\nINSERT INTO cis_audit_log VALUES (...);\nINSERT INTO cis_audit_log VALUES (...);\n\n-- Use batch insert:\nINSERT INTO cis_audit_log VALUES\n    ('id1', ...),\n    ('id2', ...),\n    ('id3', ...);\n</code></pre>"},{"location":"technical/database-schema/#backup-and-recovery","title":"Backup and Recovery","text":""},{"location":"technical/database-schema/#backup-strategy","title":"Backup Strategy","text":"<p>Kudu Snapshots: - Periodic snapshots of Kudu tablets - Point-in-time recovery - Managed by Kudu cluster</p> <p>Export to HDFS: <pre><code>-- Export table to Parquet\nINSERT OVERWRITE TABLE backup.cis_portfolio_backup\nSELECT * FROM gmp_cis.cis_portfolio;\n</code></pre></p>"},{"location":"technical/database-schema/#recovery","title":"Recovery","text":"<pre><code>-- Restore from backup\nINSERT INTO gmp_cis.cis_portfolio\nSELECT * FROM backup.cis_portfolio_backup\nWHERE name NOT IN (SELECT name FROM gmp_cis.cis_portfolio);\n</code></pre>"},{"location":"technical/database-schema/#migration-scripts","title":"Migration Scripts","text":""},{"location":"technical/database-schema/#create-all-tables","title":"Create All Tables","text":"<pre><code>-- Run in Impala\nSOURCE /path/to/cis_hive_to_kudu_tables_fixed.sql;\n</code></pre>"},{"location":"technical/database-schema/#verify-tables","title":"Verify Tables","text":"<pre><code>-- Check table exists\nSHOW TABLES IN gmp_cis LIKE 'cis_%';\n\n-- Check row counts\nSELECT COUNT(*) FROM gmp_cis.cis_portfolio;\nSELECT COUNT(*) FROM gmp_cis.cis_audit_log;\n</code></pre>"},{"location":"technical/database-schema/#related-documentation","title":"Related Documentation","text":"<ul> <li>Architecture - System architecture and patterns</li> <li>API Reference - Repository layer methods</li> <li>Development Guide - Local setup</li> </ul> <p>Last Updated: 2025-12-27 | Version: 1.0.0</p>"}]}