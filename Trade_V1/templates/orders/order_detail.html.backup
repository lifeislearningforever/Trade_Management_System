{% extends 'base.html' %}

{% block title %}Order {{ order.order_id }} - Trade Management{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="bi bi-file-earmark-text"></i> Order Details - {{ order.order_id }}</h4>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Status:</strong></div>
                        <div class="col-md-8">{% include 'includes/status_badge.html' with status=order.status %}</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Stock:</strong></div>
                        <div class="col-md-8">{{ order.stock.symbol }} - {{ order.stock.name }}</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Side:</strong></div>
                        <div class="col-md-8">
                            {% if order.side == 'BUY' %}
                            <span class="badge bg-success">{{ order.get_side_display }}</span>
                            {% else %}
                            <span class="badge bg-danger">{{ order.get_side_display }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Order Type:</strong></div>
                        <div class="col-md-8">{{ order.get_order_type_display }}</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Quantity:</strong></div>
                        <div class="col-md-8">{{ order.quantity }}</div>
                    </div>
                    {% if order.price %}
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Price:</strong></div>
                        <div class="col-md-8">{{ order.price }}</div>
                    </div>
                    {% endif %}
                    {% if order.stop_price %}
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Stop Price:</strong></div>
                        <div class="col-md-8">{{ order.stop_price }}</div>
                    </div>
                    {% endif %}
                    {% if order.client %}
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Client:</strong></div>
                        <div class="col-md-8">{{ order.client.name }}</div>
                    </div>
                    {% endif %}
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Validity:</strong></div>
                        <div class="col-md-8">{{ order.get_validity_display }}</div>
                    </div>
                    {% if order.notes %}
                    <div class="row mb-3">
                        <div class="col-md-4"><strong>Notes:</strong></div>
                        <div class="col-md-8">{{ order.notes }}</div>
                    </div>
                    {% endif %}

                    <hr>

                    <h5>Workflow Information</h5>
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Created By:</strong></div>
                        <div class="col-md-8">{{ order.created_by_name }} {% if order.created_by_employee_id %}({{ order.created_by_employee_id }}){% endif %}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Created At:</strong></div>
                        <div class="col-md-8">{{ order.created_at|date:"Y-m-d H:i:s" }}</div>
                    </div>
                    {% if order.approved_by %}
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Approved/Rejected By:</strong></div>
                        <div class="col-md-8">{{ order.approved_by_name }} {% if order.approved_by_employee_id %}({{ order.approved_by_employee_id }}){% endif %}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Approved/Rejected At:</strong></div>
                        <div class="col-md-8">{{ order.approved_at|date:"Y-m-d H:i:s" }}</div>
                    </div>
                    {% endif %}
                    {% if order.rejection_reason %}
                    <div class="row mb-2">
                        <div class="col-md-4"><strong>Rejection Reason:</strong></div>
                        <div class="col-md-8"><span class="text-danger">{{ order.rejection_reason }}</span></div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-lightning"></i> Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        {% if can_edit %}
                        <a href="{% url 'order_edit' order.pk %}" class="btn btn-warning">
                            <i class="bi bi-pencil"></i> Edit Order
                        </a>
                        {% endif %}

                        {% if can_submit %}
                        <a href="{% url 'order_submit' order.pk %}" class="btn btn-primary">
                            <i class="bi bi-send"></i> Submit for Approval
                        </a>
                        {% endif %}

                        {% if can_approve %}
                        <a href="{% url 'order_approve' order.pk %}" class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Approve Order
                        </a>
                        {% endif %}

                        {% if can_reject %}
                        <a href="{% url 'order_reject' order.pk %}" class="btn btn-danger">
                            <i class="bi bi-x-circle"></i> Reject Order
                        </a>
                        {% endif %}

                        {% if can_delete %}
                        <a href="{% url 'order_delete' order.pk %}" class="btn btn-outline-danger">
                            <i class="bi bi-trash"></i> Delete Order
                        </a>
                        {% endif %}

                        <a href="{% url 'order_list' %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Back to List
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
